apiVersion: batch/v1
kind: Job
metadata:
  name: everest-sinks
spec:
  completions: 1
  parallelism: 1
  backoffLimit: 2
  template:
    metadata:
      labels:
        app: everest
        tier: job
    spec:
      restartPolicy: OnFailure
      serviceAccountName: everest-acc
      containers:
        - name: everest-sink-ccpu
          image: iharijono/everest-flink-analytics:latest
          imagePullPolicy: Always
          resources:
            # keep request = limit to keep this container in guaranteed class
            limits:
              cpu: 50m
              memory: 50Mi
            requests:
              cpu: 50m
              memory: 50Mi
          command:
            - /app/pipeline/everest_cmd.sh
            - -s
            - -k
            - "8080"
            - -t
            - "net-c-topic,cpu-c-topic,mem-c-topic"
            - -b
            - "bootstrap.kafka:9092"
          env:
            - name: KAFKA_BOOTSTRAPPER
              value: bootstrap.kafka:9092
---
# apiVersion: batch/v1
# kind: Job
# metadata:
#   name: everest-sink-lnet
# spec:
#   completions: 1
#   parallelism: 1
#   backoffLimit: 2
#   template:
#     metadata:
#       labels:
#         app: everest
#         tier: job
#     spec:
#       restartPolicy: OnFailure
#       containers:
#         - name: everest-sink-lnet
#           image: iharijono/everest-flink-analytics:latest
#           imagePullPolicy: Always
#           resources:
#             # keep request = limit to keep this container in guaranteed class
#             limits:
#               cpu: 50m
#               memory: 50Mi
#             requests:
#               cpu: 50m
#               memory: 50Mi
#           command:
#             - /app/pipeline/everest_cmd.sh
#             - -s
#             - -t
#             - "net-l-topic"
#             - -b
#             - "bootstrap.kafka:9092"
#           env:
#             - name: KAFKA_BOOTSTRAPPER
#               value: bootstrap.kafka:9092
# ---
# Version: batch/v1
# d: Job
# adata:
# ame: everest-sink-hcpu
# c:
# ompletions: 1
# arallelism: 1
# ackoffLimit: 2
# emplate:
#  metadata:
#    labels:
#      app: everest
#      tier: job
#  spec:
#    restartPolicy: OnFailure
#    containers:
#      - name: everest-sink-hcpu
#        image: iharijono/everest-flink-analytics:latest
#        imagePullPolicy: Always
#        resources:
#          # keep request = limit to keep this container in guaranteed class
#          limits:
#            cpu: 50m
#            memory: 50Mi
#          requests:
#            cpu: 50m
#            memory: 50Mi
#        command:
#          - /app/pipeline/everest_cmd.sh
#          - -s
#          - -t
#          - "cpu-h-topic"
#          - -b
#          - "bootstrap.kafka:9092"
#        env:
#          - name: KAFKA_BOOTSTRAPPER
#            value: bootstrap.kafka:9092
# 
# Version: batch/v1
# d: Job
# adata:
# ame: everest-sink-cmem
# c:
# ompletions: 1
# arallelism: 1
# ackoffLimit: 2
# emplate:
#  metadata:
#    labels:
#      app: everest
#      tier: job
#  spec:
#    restartPolicy: OnFailure
#    containers:
#      - name: everest-sink-cmem
#        image: iharijono/everest-flink-analytics:latest
#        imagePullPolicy: Always
#        resources:
#          # keep request = limit to keep this container in guaranteed class
#          limits:
#            cpu: 50m
#            memory: 50Mi
#          requests:
#            cpu: 50m
#            memory: 50Mi
#        command:
#          - /app/pipeline/everest_cmd.sh
#          - -s
#          - -t
#          - "mem-c-topic"
#          - -b
#          - "bootstrap.kafka:9092"
#        env:
#          - name: KAFKA_BOOTSTRAPPER
#            value: bootstrap.kafka:9092
# 
# Version: batch/v1
# d: Job
# adata:
# ame: everest-sink-hmem
# c:
# ompletions: 1
# arallelism: 1
# ackoffLimit: 2
# emplate:
#  metadata:
#    labels:
#      app: everest
#      tier: job
#  spec:
#    restartPolicy: OnFailure
#    containers:
#      - name: everest-sink-hmem
#        image: iharijono/everest-flink-analytics:latest
#        imagePullPolicy: Always
#        resources:
#          # keep request = limit to keep this container in guaranteed class
#          limits:
#            cpu: 50m
#            memory: 50Mi
#          requests:
#            cpu: 50m
#            memory: 50Mi
#        command:
#          - /app/pipeline/everest_cmd.sh
#          - -s
#          - -t
#          - "mem-h-topic"
#          - -b
#          - "bootstrap.kafka:9092"
#        env:
#          - name: KAFKA_BOOTSTRAPPER
#            value: bootstrap.kafka:9092
# 
# Version: batch/v1
# d: Job
# adata:
# ame: everest-sink-cnet
# c:
# ompletions: 1
# arallelism: 1
# ackoffLimit: 2
# emplate:
#  metadata:
#    labels:
#      app: everest
#      tier: job
#  spec:
#    restartPolicy: OnFailure
#    containers:
#      - name: everest-sink-cnet
#        image: iharijono/everest-flink-analytics:latest
#        imagePullPolicy: Always
#        resources:
#          # keep request = limit to keep this container in guaranteed class
#          limits:
#            cpu: 50m
#            memory: 50Mi
#          requests:
#            cpu: 50m
#            memory: 50Mi
#        command:
#          - /app/pipeline/everest_cmd.sh
#          - -s
#          - -t
#          - "net-c-topic"
#          - -b
#          - "bootstrap.kafka:9092"
#        env:
#          - name: KAFKA_BOOTSTRAPPER
#            value: bootstrap.kafka:9092
# 
# Version: batch/v1
# d: Job
# adata:
# ame: everest-sink-hnet
# c:
# ompletions: 1
# arallelism: 1
# ackoffLimit: 2
# emplate:
#  metadata:
#    labels:
#      app: everest
#      tier: job
#  spec:
#    restartPolicy: OnFailure
#    containers:
#      - name: everest-sink-hnet
#        image: iharijono/everest-flink-analytics:latest
#        imagePullPolicy: Always
#        resources:
#          # keep request = limit to keep this container in guaranteed class
#          limits:
#            cpu: 50m
#            memory: 50Mi
#          requests:
#            cpu: 50m
#            memory: 50Mi
#        command:
#          - /app/pipeline/everest_cmd.sh
#          - -s
#          - -t
#          - "net-h-topic"
#          - -b
#          - "bootstrap.kafka:9092"
#        env:
#          - name: KAFKA_BOOTSTRAPPER
#            value: bootstrap.kafka:9092
# 